<!DOCTYPE html>
<html>
<head>
    <title>Awesome Selfhosted Form</title>
    <meta name="description" content="Awesome Selfhosted Form" />
    <meta name="author" content="Joubert RedRat" />
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
    <link href="assets/css/select2.min.css" rel="stylesheet" rel="stylesheet" />
    <link href="assets/css/form.css" rel="stylesheet" />
    <script src="assets/js/jquery-1.11.3.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/select2.min.js"></script>
    <script src="assets/js/js-markdown-extra.js"></script>
    <script src="assets/js/bootstrap-maxlength.js"></script>
    <script src="assets/js/bootbox.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('#project-description').maxlength({
                alwaysShow: true,
                validate: false,
                allowOverMax: true
            });

            $('.syntax-builder').bind('keyup', markdownBuild);
            $('#copy-markdown').bind('click', copyToClipboard);
            $('#open-issue').bind('click', openIssueForm);
            $('#clear-form').bind('click', clearForm);
            $('#project-license, #project-language').bind('change', markdownBuild);
            $("#project-license").select2();
            $("#project-language").select2({
                tags: true
            });

            loadLicenses();
            loadLanguages();
            markdownBuild();
        });

        // Build markdown syntax for input on selfhosted repo
        function markdownBuild() {
            var pname = '['+($('#project-name').val() || 'My awesome selfhosted project')+']';
            var purl = '('+($('#project-url').val() || 'https://myproject.is.awesome')+')';
            var pdesc = ' - '+($('#project-description').val() || 'Short description');
            var pdemo = $('#project-demo').val() ? '[Demo]('+($('#project-demo').val())+')' : '';
            var psrc = '[Source code]('+($('#project-source').val() || 'https://github.com/myproject/is-awesome')+')';
            var lic = '`'+($('#project-license').val() || 'License')+'`';
            var lang = '`'+($('#project-language').val() || 'Language')+'`';

            var markdown = pname+purl+pdesc+' ('+(pdemo ? pdemo+', '+psrc : psrc)+') '+lic+' '+lang;
            $('#result').val(markdown);
            $('#preview').html(Markdown(markdown)).find('a').attr('target', '_blank');
        }

        // Load Licenses from licenses.json
        function loadLicenses() {
            $.getJSON('json-data/licenses.json', function(data) {
                $.each(data, function(key, value) {
                    $('#project-license').append('<option value="'+key+'">'+key+' - '+value+'</option>');
                });
            });
        }

        // Load Licenses from languages.json
        function loadLanguages() {
            $.getJSON('json-data/languages.json', function(data){
                $.each(data, function(key, value) {
                    $('#project-language').append('<option value="'+value+'">'+value+'</option>');
                });
            });
        }

        // Copy markdown syntax to clipboard
        function copyToClipboard() {
            var $temp = $("<input>");
            $("body").append($temp);
            $temp.val($('#result').val()).select();
            document.execCommand("copy");
            $temp.remove();
            bootbox.dialog({
                message: 'Copied to clipboard: '+$('#result').val(),
                title: 'Done'
            });
        }

        // Clear form
        function clearForm() {
            $('input').val('');
            $('#project-license').val('License').trigger('change');
            $('#project-language').val('Language').trigger('change');
            $('#project-description').val('');
            markdownBuild();
        }

        // Open Issue form
        function openIssueForm() {
            errors = new Array();
            if (!$('#project-name').val())
                errors.push('Project name');
            if (!$('#project-url').val())
                errors.push('Project url');
            if (!$('#project-description').val())
                errors.push('Project description');
            if (!$('#project-source').val())
                errors.push('Project source');
            if ($('#project-license').val() == 'License')
                errors.push('License');            
            if ($('#project-language').val() == 'Language')
                errors.push('Language');

            if (errors.length > 0) {
                bootbox.dialog({
                    message: 'You must fill in the fields before sending to GitHub<br/><ul><li>'+errors.join('</li><li>')+'</li></ul>',
                    title: 'Almost there',
                    buttons: {
                        danger: {
                            label: "Okay, I will try again",
                            className: "btn-danger"
                        }
                    }
                });
                return false;
            }

            window.location = 'https://github.com/Kickball/awesome-selfhosted/issues/new?title=Add '+$('#project-name').val()+'&body='+$('#result').val();
        }
    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <h3><a href="https://github.com/Kickball/awesome-selfhosted" target="_blank">Awesome-Selfhosted</a> form <small>Hey! I'm still beta</small></h3>
        <p>This form can help you to open issue or edit file to make pull request on <a href="https://github.com/Kickball/awesome-selfhosted" target="_blank">Awesome-Selfhosted</a> repository <a href="https://github.com/Kickball/awesome-selfhosted#contributing" target="_blank">with their syntax</a> for links. If you prefer, you can help they directly on the repository.</p>
        <hr/>
    </div>
    <div class="row">
        <div class="col-xs-6">
            <div class="form-group input-group-sm">
                <label for="project-name">Project name</label>
                <input type="text" name="project-name" class="form-control syntax-builder" id="project-name" placeholder="My awesome selfhosted project">
            </div>
            <div class="form-group input-group-sm">
                <label for="project-url">Project url</label>
                <input type="url" name="project-url" class="form-control syntax-builder" id="project-url" placeholder="https://myproject.is.awesome">
            </div>
            <div class="form-group">
                <label for="project-description">Project description</label>
                <textarea rows="4" name="project-description" class="form-control syntax-builder" id="project-description" placeholder="Project description" maxlength="250"></textarea>
            </div>
            <div class="form-group">
                <label for="result">Markdown result</label>
                <button type="button" id="copy-markdown" class="btn btn-info btn-xs">Copy it!</button>
                <button type="button" id="open-issue" class="btn btn-success btn-xs">Open Issue form with this</button>
                <button type="button" id="clear-form" class="btn btn-danger btn-xs">Clear form</button>
                <textarea rows="6" name="result" class="form-control" id="result" readonly="readonly"></textarea>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="form-group input-group-sm">
                <label for="project-demo">Project demo</label>
                <input type="text" name="project-demo" class="form-control syntax-builder" id="project-demo" placeholder="https://demo.myproject.is.awesome">
            </div>
            <div class="form-group input-group-sm">
                <label for="project-source">Project source</label>
                <input type="url" name="project-source" class="form-control syntax-builder" id="project-source" placeholder="https://github.com/myproject/is-awesome">
            </div>
            <div class="form-group input-group-sm">
                <label for="project-license">License </label>
                <small class="more">Your license isn't here? <a href="https://github.com/joubertredrat/joubertredrat.github.io/issues" target="_blank">Open issue</a> or <a href="https://github.com/joubertredrat/joubertredrat.github.io/tree/master/awesome-selfhosted-form" target="_blank">make pull request</a></small>
                <select id="project-license">
                    <option value="License">Select License</option>
                </select>
            </div>
            <div class="form-group input-group-sm">
                <label for="project-language">Language</label>
                <small class="more">Your prefered language isn't here? <a href="https://github.com/joubertredrat/joubertredrat.github.io/issues" target="_blank">Open issue</a> or <a href="https://github.com/joubertredrat/joubertredrat.github.io/tree/master/awesome-selfhosted-form" target="_blank">make pull request</a></small>
                <select id="project-language">
                    <option value="Language">Select Language</option>
                </select>
            </div>
            <p><strong>Markdown preview</strong></p>
            <div id="preview"></div>
        </div>
    </div>
    <div class="row">
        <hr/>
        <p class="footer">GitHub + Opensource = So much love!</p>
    </div>
</div>
</body>
</html>